# ç¼ºé™·ç®¡ç†ç³»ç»Ÿ - æƒé™ç³»ç»Ÿè¯´æ˜

## è§’è‰²å®šä¹‰

ç³»ç»Ÿå…±æœ‰ 5 ç§è§’è‰²ï¼Œæƒé™ä»é«˜åˆ°ä½ä¾æ¬¡ä¸ºï¼š

### 1. ç®¡ç†å‘˜ (admin)
- **æƒé™**ï¼šæ‰€æœ‰æƒé™
- **æè¿°**ï¼šæ‹¥æœ‰ç³»ç»Ÿçš„å®Œå…¨æ§åˆ¶æƒï¼Œå¯ä»¥ç®¡ç†æ‰€æœ‰æ¨¡å—

### 2. äº§å“ (product)
- **æƒé™**ï¼š
  - âœ… é¡¹ç›®ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… ç¼ºé™·ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… è¯„è®ºç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… ç»Ÿè®¡åˆ†æï¼šæŸ¥çœ‹
  - âš ï¸ ç”¨æˆ·ç®¡ç†ï¼šåªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½ä¿®æ”¹
- **æè¿°**ï¼šäº§å“ç»ç†ï¼Œå¯ä»¥ç®¡ç†é¡¹ç›®å’Œç¼ºé™·ï¼Œä½†ä¸èƒ½ç®¡ç†ç”¨æˆ·

### 3. å¼€å‘ (developer)
- **æƒé™**ï¼š
  - âœ… é¡¹ç›®ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… ç¼ºé™·ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… è¯„è®ºç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… ç»Ÿè®¡åˆ†æï¼šæŸ¥çœ‹
  - âš ï¸ ç”¨æˆ·ç®¡ç†ï¼šåªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½ä¿®æ”¹
- **æè¿°**ï¼šå¼€å‘äººå‘˜ï¼Œå¯ä»¥å¤„ç†ç¼ºé™·å’Œé¡¹ç›®ï¼Œä½†ä¸èƒ½ç®¡ç†ç”¨æˆ·

### 4. æµ‹è¯• (tester)
- **æƒé™**ï¼š
  - âœ… é¡¹ç›®ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… ç¼ºé™·ç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… è¯„è®ºç®¡ç†ï¼šå¢åˆ æ”¹æŸ¥
  - âœ… ç»Ÿè®¡åˆ†æï¼šæŸ¥çœ‹
  - âš ï¸ ç”¨æˆ·ç®¡ç†ï¼šåªèƒ½æŸ¥çœ‹ï¼Œä¸èƒ½ä¿®æ”¹
- **æè¿°**ï¼šæµ‹è¯•äººå‘˜ï¼Œå¯ä»¥åˆ›å»ºå’Œç®¡ç†ç¼ºé™·ï¼Œä½†ä¸èƒ½ç®¡ç†ç”¨æˆ·

### 5. æ¸¸å®¢ (guest)
- **æƒé™**ï¼š
  - ğŸ“– æ‰€æœ‰æ¨¡å—ï¼šåªè¯»æƒé™
- **æè¿°**ï¼šè®¿å®¢ç”¨æˆ·ï¼Œåªèƒ½æŸ¥çœ‹æ•°æ®ï¼Œæ— æ³•è¿›è¡Œä»»ä½•ä¿®æ”¹æ“ä½œ

## æƒé™çŸ©é˜µ

| è§’è‰² / æ¨¡å— | é¡¹ç›®ç®¡ç† | ç”¨æˆ·ç®¡ç† | ç¼ºé™·ç®¡ç† | è¯„è®ºç®¡ç† | ç»Ÿè®¡åˆ†æ |
|------------|---------|---------|---------|---------|---------|
| ç®¡ç†å‘˜ (admin) | å¢åˆ æ”¹æŸ¥ | å¢åˆ æ”¹æŸ¥ | å¢åˆ æ”¹æŸ¥ | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ |
| äº§å“ (product) | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ | å¢åˆ æ”¹æŸ¥ | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ |
| å¼€å‘ (developer) | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ | å¢åˆ æ”¹æŸ¥ | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ |
| æµ‹è¯• (tester) | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ | å¢åˆ æ”¹æŸ¥ | å¢åˆ æ”¹æŸ¥ | æŸ¥çœ‹ |
| æ¸¸å®¢ (guest) | æŸ¥çœ‹ | æŸ¥çœ‹ | æŸ¥çœ‹ | æŸ¥çœ‹ | æŸ¥çœ‹ |

## æŠ€æœ¯å®ç°

### åç«¯

#### 1. æƒé™æ¨¡å— (`backend/permissions.py`)
```python
# æƒé™å®šä¹‰
PERMISSIONS = {
    'admin': {...},
    'product': {...},
    'developer': {...},
    'tester': {...},
    'guest': {...}
}

# æƒé™æ£€æŸ¥å‡½æ•°
def check_permission(user_role, resource, action) -> bool
def require_permission(user_role, resource, action)
```

#### 2. API æ¥å£
- `GET /api/permissions/{user_id}` - è·å–ç”¨æˆ·æƒé™
- `GET /api/roles` - è·å–æ‰€æœ‰è§’è‰²åˆ—è¡¨

### å‰ç«¯

#### 1. æƒé™ç®¡ç† Composable (`frontend/src/composables/usePermissions.ts`)
```typescript
export function usePermissions() {
  return {
    hasPermission,      // æ£€æŸ¥æ˜¯å¦æœ‰æƒé™
    canCreate,          // æ£€æŸ¥æ˜¯å¦å¯ä»¥åˆ›å»º
    canUpdate,          // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ›´æ–°
    canDelete,          // æ£€æŸ¥æ˜¯å¦å¯ä»¥åˆ é™¤
    canRead,            // æ£€æŸ¥æ˜¯å¦å¯ä»¥è¯»å–
    isAdmin,            // æ˜¯å¦æ˜¯ç®¡ç†å‘˜
    isGuest,            // æ˜¯å¦æ˜¯æ¸¸å®¢
    setCurrentUser,     // è®¾ç½®å½“å‰ç”¨æˆ·
    getCurrentUser,     // è·å–å½“å‰ç”¨æˆ·
    getRoleName         // è·å–è§’è‰²åç§°
  }
}
```

#### 2. é¡µé¢ä¸­ä½¿ç”¨æƒé™æ§åˆ¶
```vue
<template>
  <!-- åªæœ‰æœ‰åˆ›å»ºæƒé™çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°æ–°å»ºæŒ‰é’® -->
  <el-button v-if="canCreate('bugs')" @click="handleCreate">
    æ–°å»ºç¼ºé™·
  </el-button>
  
  <!-- åªæœ‰æœ‰æ›´æ–°/åˆ é™¤æƒé™çš„ç”¨æˆ·æ‰èƒ½çœ‹åˆ°æ“ä½œåˆ— -->
  <el-table-column v-if="canUpdate('bugs') || canDelete('bugs')">
    <template #default="{ row }">
      <el-button v-if="canUpdate('bugs')">ç¼–è¾‘</el-button>
      <el-button v-if="canDelete('bugs')">åˆ é™¤</el-button>
    </template>
  </el-table-column>
</template>

<script setup>
import { usePermissions } from '@/composables/usePermissions'
const { canCreate, canUpdate, canDelete } = usePermissions()
</script>
```

## è§’è‰²åˆ‡æ¢ï¼ˆæ¼”ç¤ºåŠŸèƒ½ï¼‰

åœ¨åº”ç”¨é¡¶éƒ¨æä¾›äº†è§’è‰²åˆ‡æ¢å™¨ï¼Œå¯ä»¥å¿«é€Ÿåˆ‡æ¢ä¸åŒè§’è‰²æ¥ä½“éªŒä¸åŒçš„æƒé™ï¼š

1. ç‚¹å‡»é¡¶éƒ¨çš„"å½“å‰è§’è‰²"ä¸‹æ‹‰æ¡†
2. é€‰æ‹©è¦åˆ‡æ¢çš„è§’è‰²
3. ç³»ç»Ÿä¼šç«‹å³åº”ç”¨æ–°è§’è‰²çš„æƒé™ï¼Œé¡µé¢ä¸­çš„æŒ‰é’®å’Œæ“ä½œä¼šç›¸åº”æ˜¾ç¤º/éšè—

## æ•°æ®åº“å˜æ›´

### ç”¨æˆ·è¡¨ (users)
```sql
role ENUM('admin', 'product', 'developer', 'tester', 'guest') DEFAULT 'guest'
```

### åˆå§‹åŒ–æ•°æ®
```sql
INSERT INTO users (username, email, display_name, role) VALUES 
('admin', 'admin@example.com', 'ç³»ç»Ÿç®¡ç†å‘˜', 'admin'),
('product', 'product@example.com', 'äº§å“ç»ç†', 'product'),
('developer', 'dev@example.com', 'å¼€å‘äººå‘˜', 'developer'),
('tester', 'test@example.com', 'æµ‹è¯•äººå‘˜', 'tester'),
('guest', 'guest@example.com', 'æ¸¸å®¢', 'guest');
```

## ä½¿ç”¨æŒ‡å—

### 1. é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
å¦‚æœæ•°æ®åº“å·²ç»åˆ›å»ºï¼Œéœ€è¦é‡æ–°åˆå§‹åŒ–ä»¥åº”ç”¨æ–°çš„è§’è‰²å®šä¹‰ï¼š

```bash
# è¿›å…¥ MySQL
mysql -u root -p

# åˆ é™¤æ—§æ•°æ®åº“ï¼ˆæ³¨æ„ï¼šä¼šæ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼‰
DROP DATABASE bug_management;

# é‡æ–°æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
source /path/to/bug-server/backend/init_db.sql;
```

### 2. å¯åŠ¨æœåŠ¡
```bash
cd bug-server
./start_all.sh
```

### 3. è®¿é—®ç³»ç»Ÿ
- å‰ç«¯ï¼šhttp://localhost:11234
- åç«¯ APIï¼šhttp://localhost:43211
- API æ–‡æ¡£ï¼šhttp://localhost:43211/docs

### 4. æµ‹è¯•ä¸åŒè§’è‰²
åœ¨é¡µé¢é¡¶éƒ¨åˆ‡æ¢è§’è‰²ï¼Œè§‚å¯Ÿä¸åŒè§’è‰²ä¸‹çš„æƒé™å·®å¼‚ï¼š
- **ç®¡ç†å‘˜**ï¼šæ‰€æœ‰æŒ‰é’®éƒ½å¯è§
- **äº§å“/å¼€å‘/æµ‹è¯•**ï¼šç”¨æˆ·ç®¡ç†é¡µé¢æ— æ–°å»º/ç¼–è¾‘/åˆ é™¤æŒ‰é’®
- **æ¸¸å®¢**ï¼šæ‰€æœ‰é¡µé¢éƒ½åªèƒ½æŸ¥çœ‹ï¼Œæ— ä»»ä½•æ“ä½œæŒ‰é’®

## æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼šè§’è‰²åˆ‡æ¢å™¨ä»…ç”¨äºæ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒåº”è¯¥é€šè¿‡ç™»å½•ç³»ç»Ÿæ¥ç¡®å®šç”¨æˆ·è§’è‰²
2. **åç«¯éªŒè¯**ï¼šå‰ç«¯æƒé™æ§åˆ¶ä¸»è¦ç”¨äº UI å±•ç¤ºï¼Œå®é™…æ“ä½œæƒé™åº”åœ¨åç«¯ API ä¸­è¿›è¡ŒéªŒè¯
3. **æ‰©å±•æ€§**ï¼šå¦‚éœ€æ·»åŠ æ–°è§’è‰²æˆ–è°ƒæ•´æƒé™ï¼Œä¿®æ”¹ `permissions.py` å’Œ `usePermissions.ts` å³å¯

## æœªæ¥ä¼˜åŒ–

- [ ] å®ç°çœŸå®çš„ç™»å½•è®¤è¯ç³»ç»Ÿ
- [ ] æ·»åŠ åç«¯ API æƒé™éªŒè¯ä¸­é—´ä»¶
- [ ] æ”¯æŒè‡ªå®šä¹‰è§’è‰²å’Œç»†ç²’åº¦æƒé™é…ç½®
- [ ] æ·»åŠ æ“ä½œæ—¥å¿—è®°å½•
- [ ] å®ç°åŸºäºå›¢é˜Ÿ/é¡¹ç›®çš„æƒé™éš”ç¦»

